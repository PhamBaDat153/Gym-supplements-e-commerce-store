<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard Nhân viên • FitFuel</title>

    <!-- Bootstrap 5 + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            color: #2d3748;
        }
        .sidebar {
            background: #1a1a1a;
            min-height: 100vh;
            padding-top: 2rem;
            box-shadow: 4px 0 15px rgba(0,0,0,0.1);
        }
        .sidebar .nav-link {
            color: #ccc;
            border-radius: 12px;
            margin: 0.4rem 1rem;
            padding: 0.9rem 1.5rem;
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background: #ffc107;
            color: #000;
            font-weight: 600;
            transform: translateX(10px);
        }
        .card {
            background: white;
            border: none;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
        }
        .revenue-card {
            background: linear-gradient(135deg, #ffc107, #ff8c00);
            color: white !important;
            font-weight: 700;
        }
        .revenue-card * { color: white !important; }
        .btn-fitfuel {
            background: #ffc107;
            color: #000;
            font-weight: 600;
            border: none;
        }
        .btn-fitfuel:hover {
            background: #e0a800;
            color: #000;
        }
        .text-fitfuel { color: #ffc107; }
        .hover-lift { transition: transform 0.4s; }
        .hover-lift:hover { transform: translateY(-15px); }
        .chart-container {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body class="d-flex">

<!-- Sidebar (đen) -->
<div class="sidebar col-lg-2 col-md-3 d-none d-md-flex flex-column position-fixed vh-100 overflow-auto">
    <div class="text-center my-5">
        <i class="bi bi-lightning-charge-fill text-warning display-3"></i>
        <h4 class="mt-3 mb-1 text-white">FitFuel</h4>
        <small class="text-warning d-block mb-4">Nhân viên</small>
        <hr class="border-secondary">
        <p class="fw-bold text-warning">
            <i class="bi bi-person-fill me-2"></i>
            <span sec:authentication="name">admin</span>
        </p>
    </div>

    <nav class="nav flex-column px-3">
        <a th:href="@{/store/dashboard}" class="nav-link active">
            <i class="bi bi-speedometer2 me-3"></i> Dashboard
        </a>
        <a th:href="@{/store/products}" class="nav-link">
            <i class="bi bi-box-seam me-3"></i> Quản lý sản phẩm
        </a>
        <a th:href="@{/store/orders}" class="nav-link">
            <i class="bi bi-cart-check me-3"></i> Quản lý đơn hàng
        </a>
        <a th:href="@{/store/discounts}" class="nav-link">
            <i class="bi bi-tag me-3"></i> Mã giảm giá
        </a>
        <hr class="border-secondary my-5">
        <a th:href="@{/logout}" class="nav-link text-danger">
            <i class="bi bi-box-arrow-right me-3"></i> Đăng xuất
        </a>
    </nav>
</div>

<!-- Main Content (nền trắng) -->
<div class="offset-md-3 col-md-9 offset-lg-2 col-lg-10 p-4 p-lg-5">

    <!-- Chào mừng -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <h2 class="fw-bold">
            Xin chào, <span class="text-fitfuel" sec:authentication="name">Nhân viên</span>
        </h2>
        <span class="badge bg-warning text-dark px-4 py-2 fs-6">Nhân viên cửa hàng</span>
    </div>

    <!-- 4 ô thống kê -->
    <div class="row g-4 mb-5">
        <div class="col-md-3 col-6">
            <div class="card text-center p-4">
                <i class="bi bi-box-seam display-4 text-warning"></i>
                <h5 class="mt-3 mt-3 text-muted">Tổng sản phẩm</h5>
                <h3 class="fw-bold" th:text="${totalProducts ?: '1.248'}">1.248</h3>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="card text-center p-4">
                <i class="bi bi-cart-check display-4 text-success"></i>
                <h5 class="mt-3 text-muted">Đơn hàng hôm nay</h5>
                <h3 class="fw-bold" th:text="${todayOrders ?: '47'}">47</h3>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="card text-center p-4">
                <i class="bi bi-clock-history display-4 text-primary"></i>
                <h5 class="mt-3 text-muted">Đang xử lý</h5>
                <h3 class="fw-bold" th:text="${pendingOrders ?: '23'}">23</h3>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="card revenue-card text-center p-4">
                <i class="bi bi-currency-exchange display-4"></i>
                <h5 class="mt-3">Doanh thu hôm nay</h5>
                <h3 class="fw-bold" th:text="${todayRevenue ?: '128.5 triệu'}">128.5 triệu</h3>
            </div>
        </div>
    </div>

    <!-- Biểu đồ doanh thu -->
    <div class="chart-container mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold mb-0">Doanh thu theo thời gian (triệu VNĐ)</h4>
            <div class="btn-group" role="group">
                <button class="btn btn-outline-dark btn-sm active" data-period="week">Tuần</button>
                <button class="btn btn-outline-dark btn-sm" data-period="month">Tháng</button>
                <button class="btn btn-outline-dark btn-sm" data-period="year">Năm</button>
            </div>
        </div>
        <canvas id="revenueChart" height="120"></canvas>
    </div>

    <!-- Hành động nhanh -->
    <h4 class="fw-bold mb-4">Hành động nhanh</h4>
    <div class="row g-4">
        <div class="col-md-4">
            <a th:href="@{/store/products/new}" class="text-decoration-none">
                <div class="card text-center p-5 border-warning border-3 border-dashed hover-lift" style="height: 180px;">
                    <i class="bi bi-plus-circle-fill display-3 text-warning"></i>
                    <h5 class="mt-3 fw-bold">Thêm sản phẩm mới</h5>
                </div>
            </a>
        </div>
        <div class="col-md-4">
            <a th:href="@{/store/orders?status=PENDING}" class="text-decoration-none">
                <div class="card text-center p-5 border-primary border-3 border-dashed hover-lift" style="height: 180px;">
                    <i class="bi bi-truck display-3 text-primary"></i>
                    <h5 class="mt-3 fw-bold">Xử lý đơn hàng mới</h5>
                </div>
            </a>
        </div>
        <div class="col-md-4">
            <a th:href="@{/store/discounts/new}" class="text-decoration-none">
                <div class="card text-center p-5 border-success border-3 border-dashed hover-lift" style="height: 180px;">
                    <i class="bi bi-percent display-3 text-success"></i>
                    <h5 class="mt-3 fw-bold">Tạo mã giảm giá</h5>
                </div>
            </a>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const revenueData = {
        week: { labels: ['T2','T3','T4','T5','T6','T7','CN'], data: [65,78,90,81,106,132,98] },
        month: { labels: ['Tuần 1','Tuần 2','Tuần 3','Tuần 4'], data: [320,410,380,450] },
        year: { labels: ['Th1','Th2','Th3','Th4','Th5','Th6','Th7','Th8','Th9','Th10','Th11','Th12'],
            data: [1250,1380,1520,1680,1890,2100,1980,2250,2400,2680,2900,3200] }
    };

    let chart;
    function loadChart(period) {
        const ctx = document.getElementById('revenueChart').getContext('2d');
        if (chart) chart.destroy();

        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: revenueData[period].labels,
                datasets: [{
                    label: 'Doanh thu (triệu VNĐ)',
                    data: revenueData[period].data,
                    borderColor: '#ffc107',
                    backgroundColor: 'rgba(255,193,7,0.15)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#ffc107',
                    pointRadius: 6,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { ticks: { color: '#555' }, grid: { color: '#eee' } },
                    x: { ticks: { color: '#555' }, grid: { color: '#eee' } }
                }
            }
        });
    }

    // Load năm khi vào trang
    document.addEventListener('DOMContentLoaded', () => loadChart('year'));

    // Chuyển tab
    document.querySelectorAll('[data-period]').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelector('.btn.active').classList.remove('active');
            this.classList.add('active');
            loadChart(this.getAttribute('data-period'));
        });
    });
</script>

</body>
</html>